<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_layout" inherit_id="portal.portal_layout">
        <xpath expr="//t[@t-call='portal.frontend_layout']" position="replace">
            <t t-call="portal.frontend_layout">
                <t t-set="is_portal" t-value="True"/>

                <div t-if="not no_breadcrumbs and not my_details and not breadcrumbs_searchbar" class="o_portal container mt-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <t t-call="portal.portal_breadcrumbs"/>
                        <t t-if="prev_record or next_record" t-call='portal.record_pager'/>
                    </div>
                </div>
                <div id="wrap" class='o_portal_wrap'>
                    <div class="container pt-3">
                        <t t-if="my_details">
                            <div class="wrapper col-12 d-flex flex-wrap justify-content-between align-items-center">
                                <h3 class="my-3">My account</h3>
                                <button class="btn py-0 d-flex align-items-center gap-2 d-lg-none ms-auto"
                                data-bs-toggle="offcanvas"
                                data-bs-target="#accountOffCanvas">
                                    <img class="o_avatar rounded"
                                    t-att-src="image_data_uri(user_id.partner_id.avatar_1024)" alt="Contact"/>
                                </button>
                            </div>
                            <div class="row justify-content-between">
                                <div t-attf-class="o_portal_content col-12 col-lg-8 mb-5">
                                    <t t-out="0"/>
                                </div>
                                <div class="d-none d-lg-flex justify-content-end col-lg-4">
                                    <t t-call="tyt_intranet_portal.side_content"/>
                                </div>
                                <div class="offcanvas offcanvas-start d-lg-none" id="accountOffCanvas">
                                    <t t-call="tyt_intranet_portal.side_content">
                                        <t t-set="isOffcanvas" t-value="true"/>
                                    </t>
                                </div>
                            </div>
                        </t>
                        <t t-else="">
                            <t t-out="0"/>
                        </t>
                    </div>
                </div>
            </t>
        </xpath>
    </template>

    <template id="portal_my_home" inherit_id="portal.portal_my_home">
        <xpath expr="//t[@t-call='portal.portal_layout']" position="replace">
            <t t-call="portal.portal_layout">
                <t t-set="my_details" t-value="True"/>
                <div class="o_portal_my_home">
                    <div class="oe_structure" id="oe_structure_portal_my_home_1"/>
                    <div class="o_portal_docs row g-2">
                        <div class="o_portal_doc_spinner spinner-border text-o-color-2 align-self-center mt-5"/>
                        <div t-if="portal_alert_category_enable" class="o_portal_category row g-2 mt-3" id="portal_alert_category"/>
                        <div t-if="portal_client_category_enable" class="o_portal_category row g-2 mt-3" id="portal_client_category"/>
                        <div t-if="portal_service_category_enable" class="o_portal_category row g-2 mt-3" id="portal_service_category"/>
                        <div t-if="portal_vendor_category_enable" class="o_portal_category row g-2 mt-3" id="portal_vendor_category"/>
                        <div class="o_portal_category row g-2 mt-3" id="portal_common_category">

                        </div>
                    </div>
                </div>
                <div class="oe_structure" id="oe_structure_portal_my_home_2"/>
            </t>
        </xpath>
    </template>

    <template id="portal_docs_entry" inherit_id="portal.portal_docs_entry">
        <xpath expr="//a" position="replace">
            <div t-if="not placeholder_count" class="col-md-6 order-2">
                <a t-att-href="url" t-att-title="title"
                   t-attf-class="d-flex justify-content-start gap-2 gap-md-3 align-items-center py-3 pe-2 px-md-3 h-100 rounded text-decoration-none text-reset #{bg_color if bg_color else 'text-bg-light'}">
                    <div t-if="icon" class="o_portal_icon align-self-start">
                        <img t-attf-src="#{icon}"/>
                    </div>
                    <div>
                        <h5 t-attf-class="mt-0 mb-1 #{'d-flex gap-2' if placeholder_count or count else ''}">
                            <t t-out="count"/>
                            <span t-if="placeholder_count" t-att-class="'' if show_count else 'd-none'" t-att-data-placeholder_count="placeholder_count"/>
                            <span t-out="title"/>
                        </h5>
                        <p class="m-0 text-600 lh-sm">
                            <t t-out="text"/>
                        </p>
                    </div>
                </a>
            </div>
        </xpath>
    </template>

    <template id="side_content">
        <div t-if="isOffcanvas" class="offcanvas-header justify-content-end">
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"/>
        </div>
        <div t-attf-class="{{'offcanvas-body' if isOffcanvas else 'mt-3'}}">
            <div class="d-flex justify-content-start align-items-center gap-3 mb-4">
                <img class="o_portal_contact_img rounded o_object_fit_cover" t-att-src="image_data_uri(user_id.partner_id.avatar_128)" alt="Contact" width="50"/>
                <div class="d-flex flex-column justify-content-center">
                    <h5 class="mb-0" t-out="user_id.name"/>
                    <p class="mb-0 text-muted" t-out="user_id.company_name"/>
                </div>
            </div>
            <div class="o_portal_my_details">
                <div t-field="user_id.partner_id" t-options='{"widget": "contact", "fields": ["email", "phone", "address"]}'/>
            </div>
            <a role="button" href="/my/account" class="btn btn-link p-0 mt-3"><i class="fa fa-pencil"/> Edit information</a>
            <hr t-if="sales_user"/>
            <div class="o_my_contact" t-if="sales_user">
                <t t-call="portal.portal_contact"/>
            </div>
        </div>
    </template>
</odoo>
